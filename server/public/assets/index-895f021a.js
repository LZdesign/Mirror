(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const L=document.querySelector(".hero-banner"),y=document.querySelector(".hero-div"),a=document.querySelector(".answer"),p=document.querySelector(".conversation-container"),h=document.querySelector("#textArea"),S="http://localhost:3000/questions",E=document.querySelector(".Download"),g=document.querySelector(".interaction");document.querySelector(".loading-response");const m=document.querySelector(".result");let l=[];function d(t,e){e.split(`

`).forEach(o=>{const n=document.createElement("div");n.classList.add("message",t);const s=o.split(`
`);s.forEach((i,u)=>{if(i){const c=document.createElement("p");c.textContent=i,n.appendChild(c)}u<s.length-1&&n.appendChild(document.createElement("br"))}),p.appendChild(n)}),p.scrollTop=p.scrollHeight}async function T(t){d("assistant",t),a.disabled=!1}async function q(t){t.toLowerCase().includes("end session?")?(d("assistant",t.replace(/end session\?/i,"")),a.classList.add("end-session-btn"),a.removeEventListener("click",w),a.addEventListener("click",I)):d("assistant",t)}async function C(){g.style.transform="translateY(-200%)",await new Promise(t=>setTimeout(t,200)),g.classList.add("hidden"),m.classList.remove("hidden"),m.style.transform="translateY(0)"}function f(t){const e=document.querySelector(".errorMessage"),r=document.querySelector(".errorDiv");r.style.height="auto",e.textContent=t,e.style.transform="translateY(0)",e.style.opacity="1",setTimeout(()=>{e.style.transform="translateY(-100%)",e.style.opacity="0"},2e3),setTimeout(()=>{r.style.height="0",e.textContent=""},2400)}function b(t){const e=document.querySelector(t);return(e.value?e.value.trim():e.textContent.trim())===""?(e.classList.add("error","shake"),e.addEventListener("animationend",()=>{e.classList.remove("error","shake")}),!1):!0}async function v(){let t=3,e,r=l[l.length-1];for(;t>0;)try{if(e=await fetch(S+"/"+threadId,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({prompt:r})}),e.ok){const o=await e.json();console.warn(o);const{threadId:n,messages:s}=o;return console.log(n,s),data.message.value.trim()}else throw new Error(`HTTP error! status: ${e.status}`)}catch(o){if(console.log(o),t--,t===0)throw new Error("Service is currently unavailable. Please try again later.");console.log(`Retrying... (${t} retries left)`),await new Promise(n=>setTimeout(n,2e3))}}async function I(t){t.preventDefault(),C()}function P(){const t=document.querySelector("button.generate-question");t&&t.addEventListener("click",async e=>{if(e.preventDefault(),e.target.getAttribute("data-btn")==="self-reflect"){const s=document.querySelector("#userName").value,i=document.querySelector("#focusAreaDetail").textContent,u=b("#userName"),c=b("#focusAreaDetail");if(console.log(s),console.log(i),!u||!c){f("Please fill in the empty fields");return}l=[{role:"user",content:`Begin a session with '${s}', '${s}' answered to why are you seeking out coaching: '${i}'`}],d("user",i)}t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Starting...';const n=await v();l.push({role:"assistant",content:n}),a.disabled=!0,y.classList.add("moveOut"),L.classList.add("moveIn"),setTimeout(()=>{y.classList.add("hidden")},500),T(n)})}P();async function w(t){t.preventDefault();const e=h.textContent.trim();if(!e){f("Please enter your response");return}d("user",e),a.disabled=!0,a.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading Response...',l.push({role:"user",content:e});try{const r=await v();l.push({role:"assistant",content:r}),q(r)}catch(r){console.error(r),f("An error occurred while sending your message. Please try again."),l.pop()}finally{a.classList.contains("end-session-btn")?a.innerHTML="End Session":a.innerHTML="Answer Honestly",h.textContent="",a.disabled=!1}}a.addEventListener("click",w);E.addEventListener("click",()=>{const t=document.querySelector(".DownloadReport");m.style.transform="translateY(200%)",m.classList.add("hidden"),t.classList.remove("hidden"),setTimeout(()=>{window.scrollTo(0,0),t.style.transform="translateY(0)"},500)});const D=Stripe("pk_live_UokfO3BfglTlhkt0XZ4HJtQe");document.getElementById("donation-form").addEventListener("submit",async t=>{t.preventDefault();const e=parseFloat(document.getElementById("donation-amount").value)*100,o=await(await fetch("/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})})).text();console.log("Response from server:",o);const{client_secret:n}=JSON.parse(o),s=await D.confirmCardPayment(n,{payment_method:{card:cardElement}});s.error?console.error(s.error.message):console.log("Donation successful:",s.paymentIntent)});document.querySelector(".SubmitInfo").addEventListener("click",async t=>{t.preventDefault();const e=t.target,r=document.getElementById("greeting"),o=userName,n=document.getElementById("email").value,s="83635650801174350";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){document.getElementById("email").classList.add("error","shake"),setTimeout(()=>{document.getElementById("email").classList.remove("error","shake")},1e3),e.disabled=!1,e.innerHTML="Submit Info";return}if(o&&n){e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...';try{const c=await fetch("https://www.themirrorapp.io/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,name:o,groupId:s})});c.ok?(r.textContent="Thanks for signing up! I'll be in touch soon.",console.log("Successfully added subscriber:",await c.json()),e.disabled=!1,e.classList.add("hidden")):(r.textContent="Something went wrong. Please try again.",console.error("Error adding subscriber:",await c.json()))}catch(c){console.error("Error adding subscriber:",c)}}});
